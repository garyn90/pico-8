--init
function _init()
  --player table
  player={
  sprite=1,
  x=0,
  y=54,
  dx=0,
  dy=0,
  max_dx=4,
  max_dy=4,
  alive=true,
  speed=2,
  w=8,
  h=8,
  acc=0.5,
  boost=4,
  running=false,
  jumping=false,
  land=false,
  reverse=false,
  collide=false,
  }
--ground table
ground= {
  sprite=82,
  h=8,
  w=8,
  x=0,
  y=127,
  collide=false,
  }

  gravity=0.4
  friction=.75
end




--update, draw

function _update()
player_update()
player_anim()
collision(player, ground)
end
  

function _draw()
 // cls()
 // map(0,0)
  spr(player.sprite, player.x, player.y, 1, 1, player.reverse)
  spr(ground.sprite, ground.x, ground.y)
end



--player update(), anim() 

function player_update()
  --friction and gravity
  player.dx*=friction
  player.dy+=gravity
  if player.dy > player.max_dy then
    player.dy=player.max_dy
  end
  --movement
  
  if btn(0) then
    player.dx-=player.acc
    player.running=true
    player.reverse=true
  end
    
  if (btn(1)) then
  player.dx+=player.acc
  player.running=true
  player.reverse=false 
  end
  
  --jump
  if (btnp(4))
  and player.land then
    player.dy-=player.boost
    player.jumping=true
    player.land=false
  end
  
  player.x+=player.dx
  player.y+=player.dy
  
end



--animation
function player_anim()
  if player.running then
    player.sprite+=1
    if player.sprite > 4 then
      player.sprite=1
    end
  end
  if player.jumping then
  player.sprite=44
  player.running=false
  end
  
  if player.x < 0 then
    player.x=128
  end
  if player.x >128 then
    player.x=0 
  end
end






--collision

function collision(obj1, obj2)
  local x1=obj1.x
  local x2=obj2.x
  local y1=obj1.y
  local y2=obj2.y
  local w1=obj1.w
  local w2=obj2.w
  local h1=obj1.h
  local xdiff=x2-x1
  local ydiff=y2-y1
  
  rectfill(0,0,30,30,2)
  cursor(0,0,3)
  cls()
  print(x1)
  print(y1)
  print(x2)
  print(y2)
  
  
  if x2 <(x1 + w1) 
  and y2 <(y1 + h1) then
    obj2.collide=true
    obj1.collide=true
  end
  
  if obj2.collide and
    obj1.land==true then
    obj1.dy=0
    print("you muda fucka")
  end   
end
